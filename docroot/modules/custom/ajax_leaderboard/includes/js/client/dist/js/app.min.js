"use strict";angular.module("app",["app.page","app.node","ui.router","drupalService","scrollTo","ui.bootstrap","ngSanitize","ngAnimate","ngResource","ngTouch","highcharts-ng"]).run(["$rootScope","$state","$stateParams","$window","$location",function($rootScope,$state,$stateParams,$window,$location){$rootScope.$state=$state,$rootScope.$stateParams=$stateParams,$rootScope.apiUrl="http://172.17.0.4",$rootScope.$on("$stateChangeStart",function(event,toState,toParams,fromState,fromParams){}),$rootScope.$on("$stateChangeSuccess",function(event,toState,toParams,fromState,fromParams){fromState.name&&fromState.name.length&&(!toState.data||!toState.data||!toState.data.skipScroll)})}]).config(["$locationProvider","$stateProvider","$urlRouterProvider",function($locationProvider,$stateProvider,$urlRouterProvider){$urlRouterProvider.rule(function($injector,$location){var path=$location.url();if(!path)return"/charts"}),$stateProvider.state("home",{url:"/",templateUrl:"views/home.html"})}]),angular.module("drupalService",["ngResource"]).factory("Path",["$resource","$rootScope",function($resource,$rootScope){return $resource($rootScope.apiUrl+"/api/:path",{path:"@path"},{get:{method:"GET",cache:!0,isArray:!0,transformRequest:function(data,headersGetter){headersGetter().Accept="application/hal+json"}}})}]).factory("Node",["$resource","$rootScope",function($resource,$rootScope){return $resource($rootScope.apiUrl+"/node/:nid",{nid:"@nid"},{get:{method:"GET",cache:!0,transformRequest:function(data,headersGetter){headersGetter().Accept="application/hal+json"}},patch:{method:"PATCH",transformRequest:function(data,headersGetter){return mod.drupal.hal.toServer(data),mod.drupal.setHeaders("PATCH",DrupalState,headersGetter),angular.toJson(data)}}})}]).factory("View",["$resource","$rootScope",function($resource,$rootScope){return $resource($rootScope.apiUrl+"/rest/:entity/:bundle/:a/:b/:c",{entityType:"@entity",name:"@bundle",a:"@arg0"},{query:{method:"GET",cache:!0,isArray:!0,transformRequest:function(data,headersGetter){headersGetter().Accept="application/hal+json"}}})}]).factory("TaxonomyTerm",["$resource","$rootScope",function($resource,$rootScope){return $resource($rootScope.apiUrl+"/taxonomy/term/:tid",{tid:"@tid"},{})}]).factory("User",["$resource","$rootScope",function($resource,$rootScope){return $resource($rootScope.apiUrl+"/user/:uid",{uid:"@uid"},{})}]).factory("Comment",["$resource","$rootScope",function($resource,$rootScope){return $resource($rootScope.apiUrl+"/node/:nid/comments",{nid:"@nid"},{post:{method:"POST",url:"/entity/comment"}})}]).factory("viewsFactory",["View",function(View){var service={};return service.pageLoad=function($scope,params){if(!$scope.loadingPage&&void 0!=$scope.items&&$scope.items.length>0){$scope.currentPage++;var newData=View.query(params,function(){newData.length>0&&(Array.prototype.push.apply($scope.items,newData),$scope.loadingPage=!1)})}$scope.loadingPage=!0},service}]).directive("openReveal",function(){return{restrict:"A",scope:{openReveal:"@"},link:function($scope,$element,$attrs){$element.on("click",function(){jQuery("#"+$scope.openReveal).foundation("reveal","open")})}}}),angular.module("scrollTo",[]).run(["$rootScope",function($rootScope){$rootScope.scrollTo=function(eID,scrollDiv){function currentYPosition(){return window.pageYOffset?window.pageYOffset:document.documentElement&&document.documentElement.scrollTop?document.documentElement.scrollTop:document.body.scrollTop?document.body.scrollTop:0}function elmYPosition(eID){if(eID){for(var elm=document.getElementById(eID),y=elm.offsetTop,node=elm;node.offsetParent&&node.offsetParent!=document.body;)node=node.offsetParent,y+=node.offsetTop;return y}}var i,startY=currentYPosition(),stopY=elmYPosition(eID),distance=stopY>startY?stopY-startY:startY-stopY;if(distance<100)return void scrollTo(0,stopY);var speed=Math.round(distance/100);speed>=20&&(speed=20);var step=Math.round(distance/25),leapY=stopY>startY?startY+step:startY-step,timer=0;if(stopY>startY)for(i=startY;i<stopY;i+=step)setTimeout("window.scrollTo(0, "+leapY+")",timer*speed),leapY+=step,leapY>stopY&&(leapY=stopY),timer++;else for(i=startY;i>stopY;i-=step)setTimeout("window.scrollTo(0, "+leapY+")",timer*speed),leapY-=step,leapY<stopY&&(leapY=stopY),timer++}}]),angular.module("app.page",["ui.router"]).config(["$stateProvider","$urlRouterProvider",function($stateProvider,$urlRouterProvider){$stateProvider.state("charts",{url:"/charts",data:{title:"Charts",skipScroll:!1},templateUrl:"views/charts.html",resolve:{data:function($state,$stateParams,Path){return Path.get({path:"recognitions"}).$promise.then(function(data){return data})}},controller:function($scope,$rootScope,$state,data){console.log(data);var seriesInfo={};_.map(data,function(item){console.log(item),seriesInfo[item.month]?seriesInfo[item.month].data[0]++:seriesInfo[item.month]={name:item.month,data:[1]}}),console.log(seriesInfo),seriesInfo=_.sortBy(_.values(seriesInfo),"name"),console.log(seriesInfo);var seriesCat=_.map(seriesInfo,"name");console.log(seriesCat);var chartConfig={options:{chart:{type:"column"},tooltip:{style:{padding:10,fontWeight:"bold"}}},series:seriesInfo,title:{text:"Recognitions per month"},loading:!1,xAxis:{title:{text:"Month"},categories:seriesCat},yAxis:{title:{text:"Total Count"}},useHighStocks:!1,func:function(chart){}};$scope.chartConfig=chartConfig}})}]),angular.module("app.node",["ui.router"]).config(["$stateProvider","$urlRouterProvider",function($stateProvider,$urlRouterProvider){$stateProvider.state("node",{url:"/node/:nid",template:'<div class="node node-{{type}}" ui-view></div>',resolve:{node:function($state,$stateParams,Node){return Node.get({nid:$stateParams.nid}).$promise.then(function(data){return $stateParams.type=data.type[0].target_id,data})}},controller:function($scope,$rootScope,$state,node,metaInfo){$scope.node=node,$scope.type=node.type[0].target_id,metaInfo.setTitle(node.title[0].value),node.body&&node.body[0].summary&&metaInfo.setMetaDescription(node.body[0].summary),$scope.$watch("node",function(){$rootScope.goSubRoute("node",$scope.type)})}})}]),angular.module("app").filter("orderByWeight",function(){return function(items,field,reverse){var filtered=[];return angular.forEach(items,function(item){filtered.push(item)}),filtered.sort(function(a,b){return a[field]>b[field]?1:-1}),reverse&&filtered.reverse(),filtered}}),angular.module("app").directive("pageReady",function($window,$browser){return{restrict:"A",link:function($scope,$element,$attrs){$browser.notifyWhenNoOutstandingRequests(function(){document.body.setAttribute("data-status","ready"),$scope.$root.$emit("pageReady"),$scope.$root.$broadcast("pageReady")})}}});